<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>FriScan - Mon Frigo Intelligent</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Fullscreen Toggle Button -->
    <button class="fullscreen-btn" id="fullscreen-btn" title="Plein ecran">&#x26F6;</button>

    <!-- Header -->
    <header>
        <h1>&#x1F9CA; FriScan</h1>
        <p class="subtitle">Gestionnaire de frigo intelligent</p>
        <div class="stats-bar">
            <span class="stat-badge" id="stat-total">&#x1F4E6; 0 produits</span>
            <span class="stat-badge warning" id="stat-expiring">&#x26A0;&#xFE0F; 0 bientot</span>
            <span class="stat-badge danger" id="stat-expired">&#x274C; 0 expires</span>
        </div>
    </header>

    <!-- Tabs Navigation -->
    <nav class="tabs">
        <button class="tab active" data-tab="scanner">
            <span class="tab-icon">&#x1F4F7;</span>
            <span class="tab-label">Scanner</span>
        </button>
        <button class="tab" data-tab="manual">
            <span class="tab-icon">&#x270D;&#xFE0F;</span>
            <span class="tab-label">Ajout</span>
        </button>
        <button class="tab" data-tab="fridge">
            <span class="tab-icon">&#x1F9CA;</span>
            <span class="tab-label">Frigo</span>
        </button>
        <button class="tab" data-tab="recipes">
            <span class="tab-icon">&#x1F373;</span>
            <span class="tab-label">Recettes</span>
        </button>
        <button class="tab" data-tab="settings">
            <span class="tab-icon">&#x2699;&#xFE0F;</span>
            <span class="tab-label">Reglages</span>
        </button>
    </nav>

    <!-- ============ TAB: SCANNER ============ -->
    <div id="tab-scanner" class="tab-content active">
        <div class="card">
            <h2>&#x1F4F7; Scanner un produit</h2>
            <p class="help-text">Scannez le code-barres avec la webcam/USB ou entrez-le manuellement.</p>

            <!-- Barcode Manual Input -->
            <div class="input-group" style="margin-bottom: 14px;">
                <input type="text" id="barcode-input" class="input-large" placeholder="Code-barres (ex: 3017620422003)" inputmode="numeric" style="flex:1">
                <button class="btn btn-primary" onclick="searchBarcode()">&#x1F50D; Chercher</button>
            </div>

            <!-- Camera Scanner -->
            <div class="scanner-section">
                <h3>&#x1F3A5; Camera</h3>
                <div class="camera-select-row">
                    <select id="camera-select" class="input-medium" style="flex:1">
                        <option value="">Choisir une camera...</option>
                    </select>
                    <button class="btn btn-secondary" onclick="toggleFlash()" id="flash-btn" title="Flash">&#x1F4A1;</button>
                </div>
                <div class="video-container hidden" id="video-container">
                    <video id="scanner-video" autoplay playsinline></video>
                    <div class="scanner-overlay"><div class="scan-line"></div></div>
                </div>
                <div class="scanner-controls">
                    <button class="btn btn-success" id="btn-start-cam" onclick="startCamera()">&#x1F4F7; Demarrer</button>
                    <button class="btn btn-danger hidden" id="btn-stop-cam" onclick="stopCamera()">&#x23F9; Arreter</button>
                </div>
            </div>

            <!-- Scan Result -->
            <div id="scan-result" class="scan-result hidden">
                <h3>&#x2705; Produit trouve !</h3>
                <div class="product-preview">
                    <img id="scan-img" class="product-image" src="" alt="" style="display:none">
                    <div class="product-info">
                        <div class="product-name" id="scan-name"></div>
                        <div class="product-brand" id="scan-brand"></div>
                        <div class="product-category" id="scan-category"></div>
                        <div class="product-quantity" id="scan-qty-info"></div>
                        <div id="scan-nutriscore"></div>
                    </div>
                </div>
                <div class="expiry-section">
                    <h4>&#x1F4C5; Date de peremption</h4>
                    <div class="input-group">
                        <input type="date" id="scan-expiry" class="input-date">
                        <button class="btn btn-voice" onclick="startVoiceRecognition('scan-expiry')">&#x1F3A4;</button>
                    </div>
                    <div id="scan-voice-status" class="voice-status hidden"></div>

                    <h4 style="margin-top:12px">&#x1F4E6; Quantite</h4>
                    <div class="amount-stepper">
                        <button class="stepper-btn" onclick="stepAmount('scan-amount', -1)">-</button>
                        <span class="stepper-value" id="scan-amount">1</span>
                        <button class="stepper-btn" onclick="stepAmount('scan-amount', 1)">+</button>
                    </div>
                    <div class="quantity-presets">
                        <button class="qty-preset-btn" onclick="setPresetQty('scan', '100g')">100g</button>
                        <button class="qty-preset-btn" onclick="setPresetQty('scan', '250g')">250g</button>
                        <button class="qty-preset-btn" onclick="setPresetQty('scan', '500g')">500g</button>
                        <button class="qty-preset-btn" onclick="setPresetQty('scan', '1kg')">1kg</button>
                        <button class="qty-preset-btn" onclick="setPresetQty('scan', '1L')">1L</button>
                        <button class="qty-preset-btn" onclick="setPresetQty('scan', '6x')">6x</button>
                    </div>

                    <button class="btn btn-success btn-large" onclick="addScannedProduct()">&#x2795; Ajouter au frigo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============ TAB: MANUAL ============ -->
    <div id="tab-manual" class="tab-content">
        <div class="card">
            <h2>&#x270D;&#xFE0F; Ajout rapide</h2>
            <p class="help-text">Touchez un produit courant ou cherchez dans la liste.</p>

            <!-- Category filter -->
            <div class="category-filter" id="category-filter"></div>

            <!-- Quick Products Grid -->
            <div class="quick-products-grid" id="quick-products-grid"></div>

            <!-- Manual Form -->
            <h3 style="margin-bottom:10px">Ou ajouter manuellement :</h3>
            <div class="form-group autocomplete-wrapper">
                <label for="manual-name">Nom du produit</label>
                <input type="text" id="manual-name" class="input-large" placeholder="Ex: Yaourt nature, Poulet..." autocomplete="off">
                <div id="autocomplete-list" class="autocomplete-list hidden"></div>
            </div>
            <div id="fresh-info" class="fresh-info hidden"></div>

            <div class="form-row">
                <div class="form-group">
                    <label for="manual-category">Categorie</label>
                    <select id="manual-category" class="input-large">
                        <option value="Legumes">&#x1F966; Legumes</option>
                        <option value="Fruits">&#x1F34E; Fruits</option>
                        <option value="Viandes">&#x1F969; Viandes</option>
                        <option value="Poissons">&#x1F41F; Poissons</option>
                        <option value="Produits laitiers">&#x1F95B; Produits laitiers</option>
                        <option value="Epicerie">&#x1F35E; Epicerie</option>
                        <option value="Surgeles">&#x2744;&#xFE0F; Surgeles</option>
                        <option value="Boissons">&#x1F964; Boissons</option>
                        <option value="Condiments">&#x1F9C2; Condiments</option>
                        <option value="Boulangerie">&#x1F950; Boulangerie</option>
                        <option value="Charcuterie">&#x1F356; Charcuterie</option>
                        <option value="Herbes">&#x1F33F; Herbes</option>
                        <option value="Autre">&#x1F4E6; Autre</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>&#x1F4C5; Date de peremption</label>
                    <div class="input-group">
                        <input type="date" id="manual-expiry" class="input-date">
                        <button class="btn btn-voice" onclick="startVoiceRecognition('manual-expiry')">&#x1F3A4;</button>
                    </div>
                    <div id="manual-voice-status" class="voice-status hidden"></div>
                </div>
                <div class="form-group">
                    <label>&#x1F4E6; Quantite</label>
                    <div class="amount-stepper">
                        <button class="stepper-btn" onclick="stepAmount('manual-amount', -1)">-</button>
                        <span class="stepper-value" id="manual-amount">1</span>
                        <button class="stepper-btn" onclick="stepAmount('manual-amount', 1)">+</button>
                    </div>
                </div>
            </div>

            <div class="quantity-presets">
                <button class="qty-preset-btn" onclick="setPresetQty('manual', '100g')">100g</button>
                <button class="qty-preset-btn" onclick="setPresetQty('manual', '250g')">250g</button>
                <button class="qty-preset-btn" onclick="setPresetQty('manual', '500g')">500g</button>
                <button class="qty-preset-btn" onclick="setPresetQty('manual', '1kg')">1kg</button>
                <button class="qty-preset-btn" onclick="setPresetQty('manual', '1L')">1L</button>
                <button class="qty-preset-btn" onclick="setPresetQty('manual', '1 piece')">1 piece</button>
                <button class="qty-preset-btn" onclick="setPresetQty('manual', 'lot')">Lot</button>
            </div>

            <button class="btn btn-success btn-large" onclick="addManualProduct()">&#x2795; Ajouter au frigo</button>
        </div>
    </div>

    <!-- ============ TAB: FRIDGE ============ -->
    <div id="tab-fridge" class="tab-content">
        <div class="fridge-controls">
            <input type="text" id="search-input" class="input-large" placeholder="&#x1F50D; Rechercher un produit...">
            <button class="filter-btn active" data-filter="all" onclick="setFilter('all', this)">Tous</button>
            <button class="filter-btn" data-filter="expiring" onclick="setFilter('expiring', this)">&#x26A0;&#xFE0F; Bientot</button>
            <button class="filter-btn" data-filter="expired" onclick="setFilter('expired', this)">&#x274C; Expires</button>
        </div>
        <div class="products-grid" id="products-grid"></div>
        <div id="empty-fridge" class="empty-state hidden">
            <p>&#x1F9CA;</p>
            <p>Votre frigo est vide !</p>
            <p>Scannez ou ajoutez des produits pour commencer.</p>
        </div>
    </div>

    <!-- ============ TAB: RECIPES ============ -->
    <div id="tab-recipes" class="tab-content">
        <div class="card">
            <h2>&#x1F373; Suggestions de recettes</h2>
            <p class="help-text">Recettes basees sur le contenu de votre frigo, en priorite les produits bientot perimes.</p>
            <div class="recipes-controls">
                <button class="btn btn-primary" onclick="loadRecipes()">&#x1F504; Actualiser</button>
                <select id="diet-filter" class="input-medium" onchange="loadRecipes()">
                    <option value="">Tous les regimes</option>
                    <option value="vegetarien">&#x1F966; Vegetarien</option>
                    <option value="vegan">&#x1F331; Vegan</option>
                    <option value="sans-gluten">&#x1F33E; Sans gluten</option>
                    <option value="sans-lactose">&#x1F95B; Sans lactose</option>
                </select>
            </div>
        </div>
        <div class="recipes-grid" id="recipes-grid"></div>
        <div id="empty-recipes" class="empty-state hidden">
            <p>&#x1F373;</p>
            <p>Aucune recette trouvee.</p>
            <p>Ajoutez plus de produits a votre frigo !</p>
        </div>
    </div>

    <!-- ============ TAB: SETTINGS ============ -->
    <div id="tab-settings" class="tab-content">
        <div class="card">
            <h2>&#x2699;&#xFE0F; Reglages</h2>

            <div class="settings-group">
                <h3>&#x23F0; Alerte de peremption</h3>
                <p>Nombre de jours avant expiration pour afficher un avertissement.</p>
                <div class="setting-slider">
                    <input type="range" id="expiry-days-slider" min="1" max="14" value="3" oninput="updateExpiryDays(this.value)">
                    <span class="slider-value" id="expiry-days-value">3 jours</span>
                </div>
            </div>

            <div class="settings-group">
                <h3>&#x1F37D;&#xFE0F; Regime alimentaire</h3>
                <p>Filtrer les recettes selon vos preferences alimentaires.</p>
                <div class="diet-options">
                    <button class="diet-option" data-diet="vegetarien" onclick="toggleDiet(this)">&#x1F966; Vegetarien</button>
                    <button class="diet-option" data-diet="vegan" onclick="toggleDiet(this)">&#x1F331; Vegan</button>
                    <button class="diet-option" data-diet="sans-gluten" onclick="toggleDiet(this)">&#x1F33E; Sans gluten</button>
                    <button class="diet-option" data-diet="sans-lactose" onclick="toggleDiet(this)">&#x1F95B; Sans lactose</button>
                </div>
            </div>

            <div class="settings-group">
                <h3>&#x1F4F7; Scanner</h3>
                <p>Intervalle de scan automatique (en secondes).</p>
                <div class="setting-slider">
                    <input type="range" id="scan-interval-slider" min="1" max="5" value="2" step="0.5" oninput="updateScanInterval(this.value)">
                    <span class="slider-value" id="scan-interval-value">2.0s</span>
                </div>
            </div>

            <div class="settings-group">
                <h3>&#x1F5D1;&#xFE0F; Donnees</h3>
                <button class="btn btn-danger" onclick="confirmClearAll()" style="margin-top:8px">&#x1F5D1;&#xFE0F; Vider tout le frigo</button>
            </div>

            <div class="settings-group">
                <h3>&#x2139;&#xFE0F; A propos</h3>
                <p>FriScan v2.0 - Gestionnaire de frigo tactile pour Surface Pro.</p>
                <p>Fablab Loritz &copy; 2025 - Licence MIT</p>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div class="notifications" id="notifications"></div>

    <script src="/js/voice.js"></script>
    <script src="/js/scanner.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>
