<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FriScan â€” Gestionnaire de Frigo</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- â•â•â•â•â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â• -->
    <header>
        <div class="header-content">
            <h1>ğŸ§Š FriScan</h1>
            <p class="subtitle">Gestionnaire Intelligent de Frigo</p>
        </div>
        <div id="stats-bar" class="stats-bar">
            <span id="stat-total" class="stat-badge">0 produits</span>
            <span id="stat-expiring" class="stat-badge warning">0 bientÃ´t pÃ©rimÃ©s</span>
            <span id="stat-expired" class="stat-badge danger">0 pÃ©rimÃ©s</span>
        </div>
    </header>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â• NAVIGATION TABS â•â•â•â•â•â•â•â•â•â•â•â• -->
    <nav class="tabs">
        <button class="tab active" data-tab="scanner">ğŸ“· Scanner</button>
        <button class="tab" data-tab="manual">âœï¸ Ajout manuel</button>
        <button class="tab" data-tab="fridge">ğŸ§Š Mon Frigo</button>
        <button class="tab" data-tab="recipes">ğŸ³ Recettes</button>
    </nav>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â• TAB: SCANNER â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section id="tab-scanner" class="tab-content active">
        <div class="card">
            <h2>Scanner un produit</h2>
            <p class="help-text">
                Scannez le code-barres avec votre webcam, tapez-le manuellement, 
                ou utilisez une douchette USB (elle tape le code automatiquement).
            </p>

            <!-- Scan par webcam -->
            <div class="scanner-section">
                <h3>ğŸ“· Webcam</h3>
                <div class="video-container">
                    <video id="scanner-video" autoplay playsinline></video>
                    <canvas id="scanner-canvas" style="display:none;"></canvas>
                    <div id="scanner-overlay" class="scanner-overlay">
                        <div class="scan-line"></div>
                    </div>
                </div>
                <div class="scanner-controls">
                    <button id="btn-start-cam" class="btn btn-primary" onclick="startCamera()">
                        â–¶ï¸ DÃ©marrer la camÃ©ra
                    </button>
                    <button id="btn-capture" class="btn btn-success" onclick="captureAndScan()" disabled>
                        ğŸ“¸ Scanner
                    </button>
                    <button id="btn-stop-cam" class="btn btn-secondary" onclick="stopCamera()" disabled>
                        â¹ï¸ ArrÃªter
                    </button>
                </div>
            </div>

            <!-- Scan par texte / douchette -->
            <div class="scanner-section">
                <h3>âŒ¨ï¸ Code-barres manuel / Douchette USB</h3>
                <p class="help-text">
                    Cliquez dans le champ ci-dessous, puis scannez avec la douchette ou tapez le code.
                </p>
                <div class="input-group">
                    <input type="text" id="barcode-input" placeholder="Entrez ou scannez le code-barres..."
                           class="input-large" autofocus>
                    <button class="btn btn-primary" onclick="searchBarcode()">ğŸ” Rechercher</button>
                </div>
            </div>

            <!-- RÃ©sultat du scan -->
            <div id="scan-result" class="scan-result hidden">
                <h3>Produit trouvÃ©</h3>
                <div class="product-preview">
                    <img id="result-image" src="" alt="" class="product-image">
                    <div class="product-info">
                        <p class="product-name" id="result-name"></p>
                        <p class="product-brand" id="result-brand"></p>
                        <p class="product-category" id="result-category"></p>
                        <p class="product-quantity" id="result-quantity"></p>
                        <span class="nutriscore" id="result-nutriscore"></span>
                    </div>
                </div>

                <!-- Saisie date + ajout -->
                <div class="expiry-section">
                    <h4>ğŸ“… Date limite de consommation</h4>
                    <div class="input-group">
                        <input type="date" id="result-expiry" class="input-date">
                        <button class="btn btn-voice" onclick="startVoiceRecognition('result-expiry')">
                            ğŸ¤ Dicter la date
                        </button>
                    </div>
                    <div id="voice-status" class="voice-status hidden"></div>
                    <div class="input-group" style="margin-top: 10px;">
                        <label>QuantitÃ© :</label>
                        <input type="number" id="result-amount" value="1" min="1" max="99" class="input-small">
                    </div>
                    <button class="btn btn-success btn-large" onclick="addScannedProduct()">
                        â• Ajouter au frigo
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â• TAB: AJOUT MANUEL â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section id="tab-manual" class="tab-content">
        <div class="card">
            <h2>âœï¸ Ajout manuel</h2>
            <p class="help-text">
                Pour les produits frais sans code-barres (fruits, lÃ©gumes, viande Ã  la coupe, etc.)
                Tapez le nom et choisissez dans la liste pour remplir automatiquement la catÃ©gorie et la date de pÃ©remption.
            </p>

            <!-- Grille de produits rapides -->
            <div id="quick-products" class="quick-products-grid"></div>

            <form id="manual-form" onsubmit="addManualProduct(event)">
                <div class="form-group">
                    <label for="manual-name">Nom du produit *</label>
                    <div class="autocomplete-wrapper">
                        <input type="text" id="manual-name" required
                               placeholder="Tapez pour chercher (ex: tomate, poulet, carotte...)"
                               class="input-large" autocomplete="off"
                               oninput="onManualNameInput(this.value)">
                        <div id="autocomplete-list" class="autocomplete-list hidden"></div>
                    </div>
                    <div id="fresh-info" class="fresh-info hidden">
                        <span id="fresh-icon"></span>
                        <span id="fresh-msg"></span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="manual-category">CatÃ©gorie</label>
                        <select id="manual-category" class="input-large">
                            <option value="">â€” Choisir â€”</option>
                            <option value="Fruits">ğŸ Fruits</option>
                            <option value="LÃ©gumes">ğŸ¥• LÃ©gumes</option>
                            <option value="Viandes">ğŸ¥© Viandes</option>
                            <option value="Poissons">ğŸŸ Poissons</option>
                            <option value="Produits laitiers">ğŸ§€ Produits laitiers</option>
                            <option value="Boissons">ğŸ¥¤ Boissons</option>
                            <option value="Condiments">ğŸ§‚ Condiments</option>
                            <option value="Ã‰picerie">ğŸ Ã‰picerie</option>
                            <option value="Herbes">ğŸŒ¿ Herbes</option>
                            <option value="SurgelÃ©s">ğŸ§Š SurgelÃ©s</option>
                            <option value="Autre">ğŸ“¦ Autre</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="manual-quantity">QuantitÃ© / Poids</label>
                        <input type="text" id="manual-quantity" placeholder="Ex : 500g, 1L, 6 piÃ¨ces...">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="manual-expiry">Date limite de consommation</label>
                        <div class="input-group">
                            <input type="date" id="manual-expiry">
                            <button type="button" class="btn btn-voice" onclick="startVoiceRecognition('manual-expiry')">
                                ğŸ¤ Dicter
                            </button>
                        </div>
                        <div id="voice-status-manual" class="voice-status hidden"></div>
                    </div>

                    <div class="form-group">
                        <label for="manual-amount">Nombre</label>
                        <input type="number" id="manual-amount" value="1" min="1" max="99">
                    </div>
                </div>

                <button type="submit" class="btn btn-success btn-large">
                    â• Ajouter au frigo
                </button>
            </form>
        </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â• TAB: MON FRIGO â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section id="tab-fridge" class="tab-content">
        <div class="card">
            <h2>ğŸ§Š Contenu du frigo</h2>
            <div class="fridge-controls">
                <input type="text" id="search-input" placeholder="ğŸ” Rechercher un produit..."
                       oninput="filterProducts()" class="input-large">
                <select id="filter-select" onchange="loadProducts()" class="input-medium">
                    <option value="all">Tous les produits</option>
                    <option value="in_fridge">Dans le frigo</option>
                    <option value="expiring">âš ï¸ BientÃ´t pÃ©rimÃ©s (3j)</option>
                    <option value="expired">âŒ PÃ©rimÃ©s</option>
                </select>
            </div>

            <div id="products-list" class="products-grid">
                <!-- Rempli dynamiquement -->
            </div>

            <div id="empty-fridge" class="empty-state hidden">
                <p>ğŸ§Š Votre frigo est vide !</p>
                <p>Scannez ou ajoutez des produits pour commencer.</p>
            </div>
        </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â• TAB: RECETTES â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section id="tab-recipes" class="tab-content">
        <div class="card">
            <h2>ğŸ³ Suggestions de recettes</h2>
            <p class="help-text">
                Recettes adaptÃ©es aux produits de votre frigo. Les recettes utilisant des produits 
                bientÃ´t pÃ©rimÃ©s sont priorisÃ©es.
            </p>
            <button class="btn btn-primary btn-large" onclick="loadRecipes()">
                ğŸ”„ GÃ©nÃ©rer des suggestions
            </button>

            <div id="recipes-list" class="recipes-grid">
                <!-- Rempli dynamiquement -->
            </div>

            <div id="no-recipes" class="empty-state hidden">
                <p>ğŸ³ Aucune recette trouvÃ©e.</p>
                <p>Ajoutez plus de produits dans votre frigo pour obtenir des suggestions.</p>
            </div>
        </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â• MODAL PRODUIT â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="product-modal" class="modal hidden">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â• NOTIFICATIONS â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="notifications" class="notifications"></div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â• SCRIPTS â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script src="/static/js/app.js"></script>
    <script src="/static/js/scanner.js"></script>
    <script src="/static/js/voice.js"></script>
</body>
</html>
